version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies..."
        - pip install --upgrade pip
        - pip install -r requirements.txt
    build:
      commands:
        - echo "Running database migrations..."
        - flask db upgrade
    postBuild:
      commands:
        - echo "PostBuild phase completed"
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
frontend:
  phases:
    preBuild:
      commands:
        - echo "No frontend build required for Flask application"
    build:
      commands:
        - echo "Static files already in place"
  artifacts:
    baseDirectory: static
    files:
      - '**/*'
  cache:
    paths: []
test:
  phases:
    preTest:
      commands:
        - echo "Running tests"
        - pip install pytest
    test:
      commands:
        - echo "No automated tests configured yet"
    postTest:
      commands:
        - echo "Tests completed"
  artifacts:
    baseDirectory: /
    configFilePath: '**/test-reports/*.xml'
    files:
      - '**/*.xml'

# Environment variables needed (to be configured in Amplify Console)
# SECRET_KEY
# SQLALCHEMY_DATABASE_URI
# FLASK_APP=app.py
# Add any other needed environment variables here

# Deployment settings
hosting:
  amplifyhosting:
    appRoot: /