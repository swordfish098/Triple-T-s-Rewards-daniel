<nav class="site-nav">
  <div class="nav-left">

    <a class="nav-link {{ 'active' if request.endpoint == 'common.index' else '' }}"
       href="{{ url_for('common.index') }}">
      <img src="{{ url_for('static', filename='ttt_logo.png') }}" alt="Triple T's Rewards" class="nav-logo">
    </a>

  </div>

  <div class="nav-right">
    {% if current_user.is_authenticated %}
      <a class="nav-link {{ 'active' if request.endpoint == 'notification_bp.notifications' else '' }}"
         href="{{ url_for('notification_bp.notifications') }}" aria-label="View Messages">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-message">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M8 9h8" />
          <path d="M8 13h6" />
          <path d="M12 20l-4 -4h-4a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h16a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-4l-4 4z" />
        </svg>
        <span class="visually-hidden">Send Message</span>
      </a>
      <a href="{{ url_for('rewards_bp.view_cart') }}" class="nav-link" aria-label="View Cart">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-shopping-cart">
          <circle cx="9" cy="19" r="1" />
          <circle cx="17" cy="19" r="1" />
          <path d="M5 6h16l-1.5 9h-13z" />
          <path d="M5 6l-1 -3" />
        </svg>
        <span id="cart-item-count"></span>
        <span class="visually-hidden">Cart</span>
      </a>
      <a href="{{ url_for('rewards_bp.view_wishlist') }}" class="nav-link">
        Wishlist
      </a>
      <span id="notification-bell-container">
        <a href="{{ url_for('notification_bp.notifications') }}">
          ðŸ””
        </a>
        <span id="notification-count"></span>
      </span>
      <span class="user-menu-container">
        <button class="user-menu-toggle" aria-haspopup="true" aria-expanded="false">
          <span class="user-name">Hi, {{ current_user.USERNAME }}</span>
          <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="user-menu">
          <div class="dropdown-theme-toggle">
            <span class="theme-label">Dark Mode</span>
            <label class="theme-switch">
              <input type="checkbox" id="themeToggle" />
              <span class="slider"></span>
            </label>
          </div>
          <a href="{{ url_for('auth.settings') }}">Settings</a>
          <a href="{{ url_for('auth.logout') }}">Logout</a>
        </div>
      </span>
      {% if g.is_impersonating %}
        <div class="impersonation-banner" role="status" aria-live="polite">
          <form method="POST" action="{{ url_for('impersonation_bp.stop_impersonation') }}" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-danger small" title="Stop impersonation">
              Stop impersonating ({{ g.impersonator.USERNAME if g.impersonator else 'you' }})
            </button>
          </form>
          <span class="impersonation-target">Viewing as {{ current_user.USERNAME }}</span>
        </div>
      {% endif %}
    {% else %}
      <a class="btn-primary" href="{{ url_for('auth.login') }}">Login</a>
    {% endif %}
  </div>
</nav>
