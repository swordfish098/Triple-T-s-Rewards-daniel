<aside class="sidebar">

  <nav class="sidebar-nav">
    {% if current_user.is_authenticated %}
      <a href="{{ url_for('common.index') }}" class="sidebar-link {{ 'active' if request.endpoint == 'common.index' else '' }}">
        Home
      </a>
    {% endif %}

    {% if current_user.USER_TYPE == 'administrator' %}
      {% set admin_accounts_endpoints = ['administrator_bp.accounts', 'administrator_bp.add_user', 'administrator_bp.edit_user', 'administrator_bp.locked_users', 'administrator_bp.disabled_accounts', 'administrator_bp.timeout_users'] %}
      {% set audit_endpoints = ['administrator_bp.audit_menu', 'administrator_bp.view_audit_logs', 'administrator_bp.audit_driver_points', 'administrator_bp.audit_sales_by_sponsor', 'administrator_bp.audit_sales_by_driver'] %}
      
      <div class="sidebar-section-header">Admin</div>
      <a href="{{ url_for('administrator_bp.dashboard') }}" class="sidebar-link {{ 'active' if request.endpoint == 'administrator_bp.dashboard' else '' }}">
        Admin Dashboard
      </a>
      <a href="{{ url_for('administrator_bp.accounts') }}" class="sidebar-link {{ 'active' if request.endpoint in admin_accounts_endpoints else '' }}">
        Manage Accounts
      </a>
      <a href="{{ url_for('administrator_bp.review_sponsors') }}" class="sidebar-link {{ 'active' if request.endpoint == 'administrator_bp.review_sponsors' else '' }}">
        Review Sponsors
      </a>
      <a href="{{ url_for('administrator_bp.audit_menu') }}" class="sidebar-link {{ 'active' if request.endpoint in audit_endpoints else '' }}">
        Audit Log
      </a>
    {% endif %}

    {% if current_user.USER_TYPE == 'driver' %}
      {% set driver_settings_endpoints = ['driver_bp.settings', 'driver_bp.update_contact', 'driver_bp.change_password', 'driver_bp.addresses', 'driver_bp.add_address', 'driver_bp.edit_address'] %}
      {% set driver_history_endpoints = ['driver_bp.point_history', 'driver_bp.purchase_history'] %}
      
      <div class="sidebar-section-header">Driver</div>
      <a href="{{ url_for('driver_bp.dashboard') }}" class="sidebar-link {{ 'active' if request.endpoint == 'driver_bp.dashboard' else '' }}">
        Dashboard
      </a>
      <a href="{{ url_for('rewards_bp.store') }}" class="sidebar-link {{ 'active' if request.endpoint == 'rewards_bp.store' else '' }}">
        Points Store
      </a>
      <a href="{{ url_for('driver_bp.point_history') }}" class="sidebar-link {{ 'active' if request.endpoint in driver_history_endpoints else '' }}">
        History
      </a>
      <a href="{{ url_for('driver_bp.settings') }}" class="sidebar-link {{ 'active' if request.endpoint in driver_settings_endpoints else '' }}">
        Account Settings
      </a>
      <a href="{{ url_for('driver_bp.apply_driver') }}" class="sidebar-link {{ 'active' if request.endpoint == 'driver_bp.apply_driver' else '' }}">
        Apply to Sponsor
      </a>
    {% endif %}

    {% if current_user.USER_TYPE == 'sponsor' %}
      {% set sponsor_endpoints = ['sponsor_bp.dashboard', 'sponsor_bp.update_settings'] %}
      {% set sponsor_manage_endpoints = ['sponsor_bp.manage_points_page', 'sponsor_bp.add_user', 'sponsor_bp.review_driver_applications'] %}
      {% set sponsor_history_endpoints = ['sponsor_bp.purchase_history', 'administrator_bp.audit_driver_points'] %}

      <div class="sidebar-section-header">Sponsor</div>
      <a href="{{ url_for('sponsor_bp.dashboard') }}" class="sidebar-link {{ 'active' if request.endpoint in sponsor_endpoints else '' }}">
        Dashboard
      </a>
      <a href="{{ url_for('sponsor_bp.manage_points_page') }}" class="sidebar-link {{ 'active' if request.endpoint in sponsor_manage_endpoints else '' }}">
        Driver Management
      </a>
      <a href="{{ url_for('sponsor_bp.driver_point_history') }}" class="sidebar-link {{ 'active' if request.endpoint == 'sponsor_bp.driver_point_history' else '' }}">
        Driver Point History
      </a>
      <a href="{{ url_for('sponsor_bp.purchase_history') }}" class="sidebar-link {{ 'active' if request.endpoint == 'sponsor_bp.purchase_history' else '' }}">
        Order History
      </a>
    {% endif %}
  </nav>

  <div class="sidebar-footer">
    {% if current_user.is_authenticated %}
      <a href="{{ url_for('auth.logout') }}" class="sidebar-link logout-link">
        Logout
      </a>
    {% else %}
      <a href="{{ url_for('auth.login') }}" class="sidebar-link">
        Login
      </a>
    {% endif %}
  </div>
</aside>