{# Use the UL structure from the 'main' branch #}
<aside class="app-sidebar">
    <ul class="sidebar-list">

        {# --- UNIVERSAL LINKS --- #}
        {# Home Link (from HEAD) #}
        {% if current_user.is_authenticated %}
        <li>
            <a href="{{ url_for('common.index') }}" class="sidebar-link {{ 'active' if request.endpoint == 'common.index' else '' }}">
                <span class="icon">ğŸ </span>
                Home
            </a>
        </li>
        {% endif %}

        {# Truck Rewards Store Link (for drivers) #}
        {% if current_user.is_authenticated and current_user.USER_TYPE == 'driver' %}
         <li>
            <a href="{{ url_for('rewards_bp.store') }}" class="sidebar-link {{ 'active' if request.endpoint == 'rewards_bp.store' else '' }}">
                <span class="icon">ğŸ›’</span>
                Points Store
            </a>
         </li>
        {% endif %}

        {# About Page Link #}
         <li>
            <a href="{{ url_for('about_bp.view_about') }}" class="sidebar-link {{ 'active' if request.endpoint == 'about_bp.view_about' else '' }}">
                <span class="icon">â„¹ï¸</span>
                About
            </a>
         </li>


        {# --- DASHBOARDS EXPANDABLE SECTION (Keep from 'main') --- #}
        {% if current_user.is_authenticated %}
            {% set dashboard_endpoints = [
                'administrator_bp.dashboard',
                'sponsor_bp.dashboard',
                'driver_bp.dashboard'
            ] %}
            {% set is_dashboard_active = request.endpoint in dashboard_endpoints %}

            <li class="has-submenu">
                <a href="#" class="sidebar-link submenu-toggle {% if is_dashboard_active %}expanded{% endif %}" data-target="dashboard-menu">
                     <span class="icon">ğŸ“Š</span>
                     Dashboards
                    <span class="toggle-icon">â–¼</span>
                </a>
                <ul id="dashboard-menu" class="submenu {% if not is_dashboard_active %}collapsed{% endif %}">
                    {% if current_user.USER_TYPE == 'administrator' %}
                    <li>
                        <a href="{{ url_for('administrator_bp.dashboard') }}" class="sidebar-link sub-link {{ 'active' if request.endpoint == 'administrator_bp.dashboard' else '' }}">
                            Admin Dashboard
                        </a>
                    </li>
                    {% endif %}
                    {% if current_user.USER_TYPE in ['administrator', 'sponsor'] %}
                     <li>
                        <a href="{{ url_for('sponsor_bp.dashboard') }}" class="sidebar-link sub-link {{ 'active' if request.endpoint == 'sponsor_bp.dashboard' else '' }}">
                            Sponsor Dashboard
                        </a>
                     </li>
                    {% endif %}
                    {% if current_user.USER_TYPE in ['administrator', 'sponsor', 'driver'] %}
                     <li>
                        <a href="{{ url_for('driver_bp.dashboard') }}" class="sidebar-link sub-link {{ 'active' if request.endpoint == 'driver_bp.dashboard' else '' }}">
                            Driver Dashboard
                        </a>
                     </li>
                    {% endif %}
                </ul>
            </li>
        {% endif %}

        {# --- ROLE-SPECIFIC LINKS (Integrate HEAD logic into main's structure) --- #}

        {# --- Administrator Links --- #}
        {% if current_user.is_authenticated and current_user.USER_TYPE == 'administrator' %}
            <li>
                {# Use the more comprehensive endpoint list from HEAD #}
                {% set admin_accounts_endpoints = ['administrator_bp.accounts', 'administrator_bp.add_user', 'administrator_bp.edit_user', 'administrator_bp.locked_users', 'administrator_bp.disabled_accounts', 'administrator_bp.timeout_users'] %}
                <a href="{{ url_for('administrator_bp.accounts') }}" class="sidebar-link {{ 'active' if request.endpoint in admin_accounts_endpoints else '' }}">
                     <span class="icon">ğŸ‘¥</span>
                     Manage Accounts
                </a>
            </li>
            <li>
                 <a href="{{ url_for('administrator_bp.review_sponsors') }}" class="sidebar-link {{ 'active' if request.endpoint == 'administrator_bp.review_sponsors' else '' }}">
                     <span class="icon">â­</span>
                     Review Sponsors
                 </a>
            </li>
            <li>
                {% set audit_endpoints = ['administrator_bp.audit_menu', 'administrator_bp.view_audit_logs', 'administrator_bp.audit_driver_points', 'administrator_bp.audit_sales_by_sponsor', 'administrator_bp.audit_sales_by_driver'] %}
                <a href="{{ url_for('administrator_bp.audit_menu') }}" class="sidebar-link {{ 'active' if request.endpoint in audit_endpoints else '' }}">
                     <span class="icon">ğŸ“œ</span>
                     Audit Log
                </a>
            </li>
        {% endif %}

        {# --- Sponsor Links --- #}
        {% if current_user.is_authenticated and current_user.USER_TYPE == 'sponsor' %}
             <li>
                {# Use comprehensive endpoint list from HEAD #}
                {% set sponsor_manage_endpoints = ['sponsor_bp.manage_points_page', 'sponsor_bp.add_user', 'sponsor_bp.review_driver_applications'] %}
                <a href="{{ url_for('sponsor_bp.manage_points_page') }}" class="sidebar-link {{ 'active' if request.endpoint in sponsor_manage_endpoints else '' }}">
                    <span class="icon">ğŸšš</span>
                    Driver Management
                </a>
             </li>
             <li>
                 <a href="{{ url_for('sponsor_bp.driver_point_history') }}" class="sidebar-link {{ 'active' if request.endpoint == 'sponsor_bp.driver_point_history' else '' }}">
                    <span class="icon">ğŸ’¯</span>
                    Driver Point History
                 </a>
            </li>
             <li>
                 <a href="{{ url_for('sponsor_bp.purchase_history') }}" class="sidebar-link {{ 'active' if request.endpoint == 'sponsor_bp.purchase_history' else '' }}">
                    <span class="icon">ğŸ§¾</span>
                    Order History
                 </a>
            </li>
             <li>
                  <a href="{{ url_for('sponsor_bp.update_settings') }}" class="sidebar-link {{ 'active' if request.endpoint == 'sponsor_bp.update_settings' else '' }}">
                    <span class="icon">âš™ï¸</span>
                    Store Settings
                  </a>
            </li>
        {% endif %}

        {# --- Driver Links --- #}
        {% if current_user.is_authenticated and current_user.USER_TYPE == 'driver' %}
            <li>
                {# Combine point and purchase history into one link #}
                {% set driver_history_endpoints = ['driver_bp.point_history', 'driver_bp.purchase_history'] %}
                <a href="{{ url_for('driver_bp.point_history') }}" class="sidebar-link {{ 'active' if request.endpoint in driver_history_endpoints else '' }}">
                    <span class="icon">ğŸ“–</span>
                    History
                </a>
            </li>
            <li>
                {% set driver_settings_endpoints = ['driver_bp.settings', 'driver_bp.update_contact', 'driver_bp.change_password', 'driver_bp.addresses', 'driver_bp.add_address', 'driver_bp.edit_address'] %}
                <a href="{{ url_for('driver_bp.settings') }}" class="sidebar-link {{ 'active' if request.endpoint in driver_settings_endpoints else '' }}">
                    <span class="icon">ğŸ”§</span>
                    Account Settings
                </a>
            </li>
            <li>
                <a href="{{ url_for('driver_bp.apply_driver') }}" class="sidebar-link {{ 'active' if request.endpoint == 'driver_bp.apply_driver' else '' }}">
                    <span class="icon">âœï¸</span>
                    Apply to Sponsor
                </a>
            </li>
        {% endif %}
    </ul>

    {# Footer section for Login/Logout (from HEAD) #}
    <div class="sidebar-footer">
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('auth.logout') }}" class="sidebar-link logout-link">
                 <span class="icon">ğŸšª</span>
                 Logout
            </a>
        {% else %}
            <a href="{{ url_for('auth.login') }}" class="sidebar-link">
                 <span class="icon">ğŸ”‘</span>
                 Login
            </a>
        {% endif %}
    </div>
</aside>